service: guajirobot

provider:
  name: aws
  runtime: nodejs10.x
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'eu-west-1'}
  environment:
    SERVICE_ENV: ${opt:stage, 'dev'}
    MONGO_URL: ${env:MONGO_URL}
    MONGO_DB: ${env:MONGO_DB}
    BOT_TOKEN: ${env:BOT_TOKEN}
    AIRTABLE_KEY: ${env:AIRTABLE_KEY}
    AIRTABLE_BASE: ${env:AIRTABLE_BASE}
functions:
  process:
    handler: ./index.process
    events:
      - http:
          path: /guajirobot
          method: post
          cors: true
resources:
  Resources:
    FilesBucket:
      Type: AWS::S3::Bucket
      Properties:
        CorsConfiguration:
          CorsRules:
            -
              AllowedOrigins:
                - '*'
              AllowedHeaders:
                - '*'
              AllowedMethods:
                - GET
                - PUT
              MaxAge: 3000

# Print out the name of the bucket that is created
Outputs:
  FilesBucketName:
    Value:
      Ref: FilesBucket

plugins:
  - serverless-dotenv-plugin